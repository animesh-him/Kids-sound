<!DOCTYPE html>
<html lang="en">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Listen & Tap тАФ Multilingual (Levels + Spoken Start/End)</title>
<style>
  *,*::before,*::after{ box-sizing:border-box }
  html,body{ height:100% }
  body{ margin:0; overflow-x:hidden; font-family:system-ui,Segoe UI,Arial; background:#fff7f0; color:#222 }
  .wrap{ max-width:1000px; width:100%; margin:0 auto; padding:12px }
  .langbar{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin:8px 0 }
  .lbtn{ border:1px solid #1f2937; background:#fff; color:#111827; padding:8px 14px; border-radius:999px; cursor:pointer; font-weight:700; letter-spacing:.02em }
  .lbtn.active{ background:#111827; color:#fff; border-color:#111827 }
  .hud{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin:8px 0 }
  .pill{ background:#f3f3f3; padding:8px 12px; border-radius:16px; display:inline-flex; gap:8px; align-items:center }
  .btn{ border:0; border-radius:999px; padding:10px 16px; font-weight:700; cursor:pointer; background:#111827; color:#fff }
  .levelbar{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin:8px 0 }
  .lvlbtn{ border:1px solid #78350f; background:#fff; color:#78350f; padding:8px 14px; border-radius:12px; cursor:pointer; font-weight:800; letter-spacing:.02em }
  .lvlbtn.active{ background:#78350f; color:#fff; }
  .grid{ display:grid; grid-template-columns:repeat(3, minmax(0,1fr)); gap:10px; width:100% }
  @media (min-width:760px){ .grid{ grid-template-columns:repeat(4, minmax(0,1fr)) } }
  .cell{ width:100%; border:1px solid #ddd; border-radius:12px; padding:22px 12px; min-height:86px; display:flex; align-items:center; justify-content:center; position:relative; font-size:26px }
  .label3d{ font-weight:900; letter-spacing:.03em; text-transform:uppercase }
  .label3d.white{ color:#fff; text-shadow:0 1px 0 rgba(0,0,0,.25),0 2px 0 rgba(0,0,0,.2),0 3px 0 rgba(0,0,0,.15),0 4px 0 rgba(0,0,0,.1),0 6px 6px rgba(0,0,0,.35) }
  .label3d.black{ color:#111; text-shadow:0 1px 0 rgba(255,255,255,.45),0 2px 0 rgba(255,255,255,.35),0 3px 0 rgba(255,255,255,.25),0 4px 0 rgba(255,255,255,.15),0 6px 6px rgba(0,0,0,.2) }
  .muted{ color:#666 }
  footer.smallnote{ margin-top:14px; color:#666; font-size:13px; line-height:1.35 }
</style>
<body>
<div class="wrap">
  <h1>ЁЯСВ Listen & Tap тАФ Multilingual (Levels)</h1>
  <p class="muted">Level 1 shows <b>3D English labels</b> on color blocks; Level 2 uses <b>pure color blocks</b>. Spoken prompts use the selected language.</p>

  <div class="langbar" id="langbar"></div>

  <div class="levelbar">
    <button class="lvlbtn active" id="lvl1">Level 1 (Labels)</button>
    <button class="lvlbtn" id="lvl2">Level 2 (No Labels)</button>
  </div>

  <div class="hud">
    <span class="pill">Score: <b id="s">0</b></span>
    <span class="pill">тП▒я╕П <b id="t">60</b>s</span>
    <button class="btn" id="say">ЁЯЧгя╕П Speak</button>
    <button class="btn" id="start">Start</button>
    <button class="btn" id="mute">ЁЯФК Sound: On</button>
  </div>

  <div id="grid" class="grid"></div>
  <p id="status" class="pill">Status: Press Start to begin тАФ <b>LetтАЩs play, gently tap on me!</b></p>

  <footer class="smallnote">
    тД╣я╕П If you install <b>Google Speech Services</b> and add Bengali, Gujarati, Spanish, etc. as a <i>system language</i>, Chrome can use a native voice.<br>
    ЁЯТм If you donтАЩt see your language available, comment on the Games webpage тАФ I will include it. Have fun!
  </footer>
</div>

<script>
/* === Colors === */
var COLORS=[['red','#e63946'],['blue','#277da1'],['green','#2a9d8f'],['yellow','#ffd166'],['orange','#f4a261'],['pink','#ff6ea9'],['brown','#8d5524'],['black','#111111'],['white','#eeeeee'],['violet','#7F00FF'],['indigo','#4B0082']];

/* === Languages: English first, others AтАУZ; UK English priority === */
var BASE_LANGS=[
  ['en','English',['en-GB','en-US','en-IN','en']],
  ['as','Assamese',['as-IN','as']], ['bn','Bengali',['bn-IN','bn-BD','bn']],
  ['de','German',['de-DE','de']], ['es','Spanish',['es-ES','es-MX','es']],
  ['fr','French',['fr-FR','fr']], ['gu','Gujarati',['gu-IN','gu']],
  ['hi','Hindi',['hi-IN','hi']], ['ja','Japanese',['ja-JP','ja']],
  ['kn','Kannada',['kn-IN','kn']], ['ko','Korean',['ko-KR','ko']],
  ['ml','Malayalam',['ml-IN','ml']], ['mr','Marathi',['mr-IN','mr']],
  ['or','Odia',['or-IN','or']], ['pa','Punjabi',['pa-IN','pa']],
  ['ta','Tamil',['ta-IN','ta']], ['te','Telugu',['te-IN','te']]
];
var LANG_CANDIDATES=(function(){var en=BASE_LANGS.find(x=>x[0]==='en');var others=BASE_LANGS.filter(x=>x[0]!=='en').sort((a,b)=>a[1].localeCompare(b[1]));return [en].concat(others);})();

/* === Localized names for speech === */
var L10N={
  en:{red:'red',blue:'blue',green:'green',yellow:'yellow',orange:'orange',pink:'pink',brown:'brown',black:'black',white:'white',violet:'violet',indigo:'indigo'},
  bn:{ red:'рж▓рж╛рж▓', blue:'ржирзАрж▓', green:'рж╕ржмрзБржЬ', yellow:'рж╣рж▓рзБржж', orange:'ржХржорж▓рж╛', pink:'ржЧрзЛрж▓рж╛ржкрж┐', brown:'ржмрж╛ржжрж╛ржорзА', black:'ржХрж╛рж▓рзЛ', white:'рж╕рж╛ржжрж╛', violet:'ржЬрж╛ржорзБржирж┐', indigo:'ржирзАрж▓ржЪрзЗ' },
  hi:{red:'рд▓рд╛рд▓',blue:'рдиреАрд▓рд╛',green:'рд╣рд░рд╛',yellow:'рдкреАрд▓рд╛',orange:'рдирд╛рд░рдВрдЧреА',pink:'рдЧреБрд▓рд╛рдмреА',brown:'рднреВрд░рд╛',black:'рдХрд╛рд▓рд╛',white:'рд╕рдлреЗрдж',violet:'рдЬрд╛рдореБрдиреА',indigo:'рдиреАрд▓'},
  kn:{red:'р▓Хр│Жр▓Вр▓кр│Б',blue:'р▓ир│Ар▓▓р▓┐',green:'р▓╣р▓╕р▓┐р▓░р│Б',yellow:'р▓╣р▓│р▓жр▓┐',orange:'р▓Хр▓┐р▓др│Нр▓др▓│р│Ж',pink:'р▓Чр│Бр▓▓р▓╛р▓мр▓┐',brown:'р▓Хр▓Вр▓жр│Б',black:'р▓Хр▓кр│Нр▓кр│Б',white:'р▓мр▓┐р▓│р▓┐',violet:'р▓╡р▓пр│Кр▓▓р│Жр▓Яр│Н',indigo:'р▓Зр▓Вр▓бр▓┐р▓Чр│Л'},
  ta:{red:'роЪро┐ро╡рокрпНрокрпБ',blue:'роирпАро▓роорпН',green:'рокроЪрпНроЪрпИ',yellow:'роороЮрпНроЪро│рпН',orange:'роЖро░роЮрпНроЪрпБ',pink:'роЗро│роЮрпНроЪро┐ро╡рокрпНрокрпБ',brown:'рокро┤рпБрокрпНрокрпБ',black:'роХро░рпБрокрпНрокрпБ',white:'ро╡рпЖро│рпНро│рпИ',violet:'ро╡рпИро▓рпЖроЯрпН',indigo:'роЗрогрпНроЯро┐роХрпЛ'},
  te:{red:'р░Ор░░р▒Бр░кр▒Б',blue:'р░ир▒Ар░▓р░В',green:'р░Жр░Хр▒Бр░кр░Ър▒Нр░Ъ',yellow:'р░кр░╕р▒Бр░кр▒Б',orange:'р░ир░╛р░░р░┐р░Вр░Ь',pink:'р░Чр▒Бр░▓р░╛р░мр▒А',brown:'р░Чр▒Лр░зр▒Бр░о',black:'р░ир░▓р▒Бр░кр▒Б',white:'р░др▒Жр░▓р▒Бр░кр▒Б',violet:'р░╡р░пр▒Кр░▓р▒Жр░Яр▒Н',indigo:'р░Зр░Вр░бр░┐р░Чр▒Л'},
  gu:{red:'рк▓рк╛рк▓',blue:'рк╡рк╛ркжрк│рлА',green:'рк▓рлАрк▓рлЛ',yellow:'рккрлАрк│рлЛ',orange:'ркирк╛рк░ркВркЧрлА',pink:'рккрк┐ркВркХ',brown:'ркдрккркЦрлАрк░',black:'ркХрк╛рк│рлЛ',white:'рк╕рклрлЗркж',violet:'рк╡рк╛ркпрлЛрк▓рлЗркЯ',indigo:'ркЗркирлНркбрк┐ркЧрлЛ'},
  as:{ red:'рж▓рж╛рж▓', blue:'ржирзАрж▓рж╛', green:'рж╕рзЗржЙржЬ', yellow:'рж╣рж▓рзБржж', orange:'ржХржорж▓рж╛', pink:'ржЧрзЛрж▓рж╛ржкрзА', brown:'ржмрж╛ржжрж╛ржорзА', black:'ржХтАЩрж▓рж╛', white:'рж╕рж╛ржжрж╛', violet:'ржмрзЗржЧрзБржирж┐', indigo:'ржЗржгрзНржбрж┐ржЧрзЛ' },
  ml:{ red:'р┤Ър╡Бр┤╡р┤кр╡Нр┤кр╡Н', blue:'р┤ир╡Ар┤▓', green:'р┤кр┤Ър╡Нр┤Ъ', yellow:'р┤ор┤Юр╡Нр┤Ю', orange:'р┤Ур┤▒р┤Юр╡Нр┤Ър╡Н', pink:'р┤кр┤┐р┤Щр╡Нр┤Хр╡Н', brown:'р┤др┤╡р┤┐р┤Яр╡Нр┤Яр╡Н', black:'р┤Хр┤▒р╡Бр┤кр╡Нр┤кр╡Н', white:'р┤╡р╡Жр┤│р╡Бр┤кр╡Нр┤кр╡Н', violet:'р┤╡р┤пр┤▓р┤▒р╡Нр┤▒р╡Н', indigo:'р┤Зр┤гр╡Нр┤Яр┤┐р┤Чр╡Л' },
  pa:{ red:'ри▓ри╛ри▓', blue:'риирйАри▓ри╛', green:'ри╣ри░ри╛', yellow:'рикрйАри▓ри╛', orange:'риири╛ри░рй░риЧрйА', pink:'риЧрйБри▓ри╛римрйА', brown:'ринрйВри░ри╛', black:'риХри╛ри▓ри╛', white:'риЪри┐рй▒риЯри╛', violet:'римрйИрй░риЧриирйА', indigo:'риЗрй░рибри┐риЧрйЛ' },
  or:{ red:'рм▓рм╛рм▓', blue:'рмирнАрм│', green:'рм╕рммрнБрмЬ', yellow:'рм╣рм│рмжрм┐рмЖ', orange:'рмХрморм│рм╛', pink:'рмЧрнЛрм▓рм╛рмкрнА', brown:'рммрм╛рмжрм╛рморнА', black:'рмХрм│рм╛', white:'рмзрм│рм╛', violet:'рммрмЗрмЧрмгрнА', indigo:'рмЗрмгрнНрмбрм┐рмЧрнЛ' },
  mr:{ red:'рд▓рд╛рд▓', blue:'рдирд┐рд│рд╛', green:'рд╣рд┐рд░рд╡рд╛', yellow:'рдкрд┐рд╡рд│рд╛', orange:'рдирд╛рд░рд┐рдВрдЧреА', pink:'рдЧреБрд▓рд╛рдмреА', brown:'рждрдкрдХрд┐рд░реА', black:'рдХрд╛рд│рд╛', white:'рдкрд╛рдВрдврд░рд╛', violet:'рдЬрд╛рдВрднрд│рд╛', indigo:'рдЗрдВрдбрд┐рдЧреЛ' },
  ja:{red:'ш╡д',blue:'щЭТ',green:'ч╖С',yellow:'щ╗Д',orange:'уВкуГмуГ│уВ╕',pink:'уГФуГ│уВп',brown:'шМ╢шЙ▓',black:'щ╗Т',white:'чЩ╜',violet:'уГРуВдуВкуГмуГГуГИ',indigo:'уВдуГ│уГЗуВгуВ┤'},
  de:{red:'rot',blue:'blau',green:'gr├╝n',yellow:'gelb',orange:'orange',pink:'rosa',brown:'braun',black:'schwarz',white:'wei├Я',violet:'violett',indigo:'indigo'},
  ko:{red:'ы╣иъ░Х',blue:'эММыЮС',green:'ь┤ИыбЭ',yellow:'ыЕ╕ыЮС',orange:'ьг╝эЩй',pink:'ы╢ДэЩН',brown:'ъ░ИьГЙ',black:'ъ▓АьаХ',white:'эХШьЦС',violet:'ы░ФьЭ┤ьШмыаЫ',indigo:'ьЭ╕ыФФъ│а'},
  fr:{red:'rouge',blue:'bleu',green:'vert',yellow:'jaune',orange:'orange',pink:'rose',brown:'marron',black:'noir',white:'blanc',violet:'violet',indigo:'indigo'},
  es:{red:'rojo',blue:'azul',green:'verde',yellow:'amarillo',orange:'naranja',pink:'rosa',brown:'marr├│n',black:'negro',white:'blanco',violet:'violeta',indigo:'├нndigo'}
};

/* === Audio/Speech === */
var voices=[], voice=null, currentLang='en', soundOn=true;
function speak(text){
  if(!soundOn || !voice || !text) return;
  try{
    var u=new SpeechSynthesisUtterance(text);
    u.voice=voice; u.rate=1; u.pitch=1;
    window.speechSynthesis.cancel(); window.speechSynthesis.speak(u);
  }catch(e){}
}
function nameFor(key){ var pack=L10N[currentLang]||L10N.en; return pack[key]||key; }

/* === Messages === */
var POSITIVE=["Brilliant!","Great job!","You nailed it!","Super!","Awesome move!","Fantastic!","Spot on!","You're on fire!","Nice pick!","Keep it up!","Well done!","Perfect!","Excellent!","Sharp eyes!","Love that focus!","Crushing it!","ThatтАЩs the spirit!","Beautiful tap!","YouтАЩre unstoppable!","Champion energy!"];
var TRY_AGAIN=["Almost thereтАФtry again!","So close!","Keep goingтАФyouтАЩve got this!","Good effortтАФtry once more!","No worries, next one!","Eyes on the prize!","You can do it!","Stay sharp!","Keep tappingтАФpractice wins!","One more try!","We learn by trying!","No problemтАФnext one is yours!","Steady now, youтАЩve got it!","Take a breath and go again!","ItтАЩs all practiceтАФwell done!","Trust your eyes!","Great spirit!","Tap again with confidence!","Strong effort!","Keep the rhythm!"];
var END_LOW=["You are my buddy тЭдя╕П Let's play again, shall we?","Great try! Next round will be even better.","You did wonderful тАФ score doesnтАЩt matter, fun does!","Cheer up champ! LetтАЩs go again soon.","Every tap counts, youтАЩre improving already!","You are awesome тАФ the score is just a number.","Keep shining, youтАЩre my favorite player!","Smile! Games are for joy, not just points.","Fantastic spirit! LetтАЩs try one more time.","High five ЁЯдЪ You played with heart!","Your energy is amazing тАФ keep tapping!","Friend, youтАЩre building skills every round.","No worries тАФ weтАЩre in this together!","You brighten the game тАФ keep going!","A little score, but a big heart!","The fun matters more than the score!","Play again? IтАЩll cheer you louder!","Next time will be your round!","YouтАЩre a true buddy gamer!","Keep that smile, champion!"];
var END_HIGH=["Wow! You crushed it! ЁЯПЖ","Amazing score тАФ youтАЩre a star!","Champion vibes only тЬи Keep it up!","Fantastic! ThatтАЩs true focus.","YouтАЩre unstoppable тАФ what a round!","Incredible tapping skills ЁЯСП","Brilliant memory and speed!","Legendary score тАФ salute!","Excellent! YouтАЩve set a new bar.","Superb тАФ you made me proud!","Victory dance time ЁЯТГЁЯХ║","YouтАЩre glowing with success!","A masterpiece of tapping!","Bravo! A champion indeed.","High score, high spirit!","Unstoppable energy тАФ wow!","Keep rocking superstar!","ThatтАЩs record-breaking speed!","Phenomenal! You inspire me!","Hall of fame performance!"];
function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

/* === Game state === */
var playing=false, secs=60, score=0, target=0, timer=null, level=1;
var grid=document.getElementById('grid'), statusEl=document.getElementById('status');
function updateStatus(m){ statusEl.textContent='Status: '+m; }
function shuffle(a){ for(var i=a.length-1;i>0;i--){ var j=Math.floor(Math.random()*(i+1)); var t=a[i]; a[i]=a[j]; a[j]=t; } return a; }
function labelTone(hex){ var r=parseInt(hex.substr(1,2),16),g=parseInt(hex.substr(3,2),16),b=parseInt(hex.substr(5,2),16); var L=0.2126*(r/255)+0.7152*(g/255)+0.0722*(b/255); return (L<0.55)?'white':'black'; }

/* === ONLY CHANGE BEGINS: Bengali MP3 when speaking color name === */
function speakColorKey(key, text){
  if(!text) text = (L10N[currentLang] && L10N[currentLang][key]) ? L10N[currentLang][key] : key;
  if(currentLang === 'bn' && soundOn){
    try{
      var audio = new Audio('animesh-him/audio/bn/' + key + '.mp3');
      var p = audio.play();
      if(p !== undefined){
        p.catch(function(){ speak(text); }); // fallback to TTS if file missing/blocked
      }
      return;
    }catch(e){
      speak(text); // fallback
      return;
    }
  }
  // All other languages unchanged тЖТ TTS
  speak(text);
}
/* === ONLY CHANGE ENDS === */

function nextRound(){ target=Math.floor(Math.random()*COLORS.length); speakColorKey(COLORS[target][0], nameFor(COLORS[target][0])); rebuildTiles(); }
function rebuildTiles(){
  grid.innerHTML='';
  var order=shuffle(COLORS.slice());
  order.forEach(function(item){
    var key=item[0], bg=item[1], d=document.createElement('button');
    d.className='cell'; d.style.background=bg; d.style.borderColor='#00000020'; d.style.width='100%';
    if(level===1){
      var tone=labelTone(bg), span=document.createElement('span');
      span.className='label3d '+(tone==='white'?'white':'black');
      span.textContent=key.toUpperCase();
      d.appendChild(span);
    }
    d.onclick=function(){ choose(key===COLORS[target][0]); };
    grid.appendChild(d);
  });
}
function choose(ok){
  if(!playing) return;
  if(ok){ score++; document.getElementById('s').textContent=score; updateStatus('Score: '+score+' тАФ '+pick(POSITIVE)); nextRound(); }
  else  { score=Math.max(0,score-1); document.getElementById('s').textContent=score; updateStatus('Score: '+score+' тАФ '+pick(TRY_AGAIN)); }
}

/* === Controls === */
document.getElementById('say').onclick=function(){ if(playing) speakColorKey(COLORS[target][0], nameFor(COLORS[target][0])); };
document.getElementById('start').onclick=function(){
  playing=true; secs=60; score=0;
  document.getElementById('s').textContent=0; document.getElementById('t').textContent=secs;
  var startLine="LetтАЩs play тАФ gently tap on me!";
  updateStatus("Game started. Language: "+readableLangLabel(currentLang, voice)+" тАв Score: 0 тАФ "+startLine);
  speak(startLine); // ЁЯФК start message stays TTS (all languages)
  nextRound();
  if(timer) clearInterval(timer);
  timer=setInterval(function(){
    secs--; document.getElementById('t').textContent=secs;
    if(secs<=0){
      clearInterval(timer); playing=false;
      var msg=(score<5?pick(END_LOW):pick(END_HIGH));
      var endLine="TimeтАЩs up! Final score: "+score+". "+msg;
      updateStatus("тП░ "+endLine);
      speak(endLine); // ЁЯФК end message stays TTS (all languages)
    }
  },1000);
};
document.getElementById('mute').onclick=function(e){ soundOn=!soundOn; e.target.textContent=soundOn?'ЁЯФК Sound: On':'ЁЯФЗ Sound: Off'; };
document.getElementById('lvl1').onclick=function(){ level=1; this.classList.add('active'); document.getElementById('lvl2').classList.remove('active'); if(playing) rebuildTiles(); updateStatus("Level 1 (Labels) selected. LetтАЩs play, gently tap on me!"); };
document.getElementById('lvl2').onclick=function(){ level=2; this.classList.add('active'); document.getElementById('lvl1').classList.remove('active'); if(playing) rebuildTiles(); updateStatus("Level 2 (No Labels) selected. LetтАЩs play, gently tap on me!"); };

/* === Language bar (voice-verified) === */
var langbar=document.getElementById('langbar');
function readableLangLabel(code,v){
  if(code==='en'&&v){ var L=(v.lang||'').toLowerCase();
    if(L.startsWith('en-gb')) return 'English (UK)';
    if(L.startsWith('en-us')) return 'English (US)';
    if(L.startsWith('en-in')) return 'English (India)';
    return 'English';
  }
  var f=LANG_CANDIDATES.find(x=>x[0]===code); return f?f[1]:code;
}
function refreshVoices(){
  try{ voices=window.speechSynthesis?window.speechSynthesis.getVoices():[]; }catch(e){ voices=[]; }
  langbar.innerHTML='';
  LANG_CANDIDATES.forEach(function(cfg){
    var code=cfg[0], label=cfg[1], tags=cfg[2];
    var v=voices.find(function(vc){ return tags.some(function(t){ return (vc.lang||'').toLowerCase().startsWith(t.toLowerCase()); }); });
    if(v){
      var b=document.createElement('button'); b.className='lbtn'; b.textContent=(code==='en')?'English':label; b.dataset.code=code;
      b.onclick=function(){
        currentLang=code; voice=v;
        Array.prototype.forEach.call(langbar.children,x=>x.classList.remove('active'));
        b.classList.add('active');
        updateStatus('Language: '+readableLangLabel(code,v)+' тАв Voice: '+(v.name||v.lang)+' тАв Score: '+score);
        if(playing) nextRound();
      };
      langbar.appendChild(b);
      if(code==='en' && !document.querySelector('.lbtn.active')){ b.classList.add('active'); currentLang='en'; voice=v; }
    }
  });
  updateStatus(langbar.children.length? 'Voices ready ('+langbar.children.length+' languages). Press Start!' : 'No compatible voices detected. You can still play by tapping colors.');
}
try{
  if(window.speechSynthesis){
    window.speechSynthesis.onvoiceschanged=refreshVoices;
    setTimeout(refreshVoices,200);
  }else{
    updateStatus('Speech synthesis not available in this browser.');
  }
}catch(e){ updateStatus('Speech init error.'); }
</script>
</body>
</html>
