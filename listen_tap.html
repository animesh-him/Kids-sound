<!DOCTYPE html>
<html lang="en">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Listen & Tap ‚Äî Multilingual (Levels + Spoken Start/End)</title>
<style>
  *,*::before,*::after{ box-sizing:border-box }
  html,body{ height:100% }
  body{ margin:0; overflow-x:hidden; font-family:system-ui,Segoe UI,Arial; background:#fff7f0; color:#222 }
  .wrap{ max-width:1000px; width:100%; margin:0 auto; padding:12px }
  .langbar{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin:8px 0 }
  .lbtn{ border:1px solid #1f2937; background:#fff; color:#111827; padding:8px 14px; border-radius:999px; cursor:pointer; font-weight:700; letter-spacing:.02em }
  .lbtn.active{ background:#111827; color:#fff; border-color:#111827 }
  .hud{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin:8px 0 }
  .pill{ background:#f3f3f3; padding:8px 12px; border-radius:16px; display:inline-flex; gap:8px; align-items:center }
  .btn{ border:0; border-radius:999px; padding:10px 16px; font-weight:700; cursor:pointer; background:#111827; color:#fff }
  .levelbar{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin:8px 0 }
  .lvlbtn{ border:1px solid #78350f; background:#fff; color:#78350f; padding:8px 14px; border-radius:12px; cursor:pointer; font-weight:800; letter-spacing:.02em }
  .lvlbtn.active{ background:#78350f; color:#fff; }
  .grid{ display:grid; grid-template-columns:repeat(3, minmax(0,1fr)); gap:10px; width:100% }
  @media (min-width:760px){ .grid{ grid-template-columns:repeat(4, minmax(0,1fr)) } }
  .cell{ width:100%; border:1px solid #ddd; border-radius:12px; padding:22px 12px; min-height:86px; display:flex; align-items:center; justify-content:center; position:relative; font-size:26px }
  .label3d{ font-weight:900; letter-spacing:.03em; text-transform:uppercase }
  .label3d.white{ color:#fff; text-shadow:0 1px 0 rgba(0,0,0,.25),0 2px 0 rgba(0,0,0,.2),0 3px 0 rgba(0,0,0,.15),0 4px 0 rgba(0,0,0,.1),0 6px 6px rgba(0,0,0,.35) }
  .label3d.black{ color:#111; text-shadow:0 1px 0 rgba(255,255,255,.45),0 2px 0 rgba(255,255,255,.35),0 3px 0 rgba(255,255,255,.25),0 4px 0 rgba(255,255,255,.15),0 6px 6px rgba(0,0,0,.2) }
  .muted{ color:#666 }
  footer.smallnote{ margin-top:14px; color:#666; font-size:13px; line-height:1.35 }
</style>
<body>
<div class="wrap">
  <h1>üëÇ Listen & Tap ‚Äî Multilingual (Levels)</h1>
  <p class="muted">Level 1 shows <b>3D English labels</b> on color blocks; Level 2 uses <b>pure color blocks</b>. Spoken prompts use the selected language.</p>

  <div class="langbar" id="langbar"></div>

  <div class="levelbar">
    <button class="lvlbtn active" id="lvl1">Level 1 (Labels)</button>
    <button class="lvlbtn" id="lvl2">Level 2 (No Labels)</button>
  </div>

  <div class="hud">
    <span class="pill">Score: <b id="s">0</b></span>
    <span class="pill">‚è±Ô∏è <b id="t">60</b>s</span>
    <button class="btn" id="say">üó£Ô∏è Speak</button>
    <button class="btn" id="start">Start</button>
    <button class="btn" id="mute">üîä Sound: On</button>
  </div>

  <div id="grid" class="grid"></div>
  <p id="status" class="pill">Status: Press Start to begin ‚Äî <b>Let‚Äôs play, gently tap on me!</b></p>

  <footer class="smallnote">
    ‚ÑπÔ∏è If you install <b>Google Speech Services</b> and add Bengali, Gujarati, Spanish, etc. as a <i>system language</i>, Chrome can use a native voice.<br>
    üí¨ If you don‚Äôt see your language available, comment on the Games webpage ‚Äî I will include it. Have fun!
  </footer>
</div>

<script>
/* === Colors === */
var COLORS=[['red','#e63946'],['blue','#277da1'],['green','#2a9d8f'],['yellow','#ffd166'],['orange','#f4a261'],['pink','#ff6ea9'],['brown','#8d5524'],['black','#111111'],['white','#eeeeee'],['violet','#7F00FF'],['indigo','#4B0082']];

/* === Languages === */
var BASE_LANGS=[
  ['en','English',['en-GB','en-US','en-IN','en']],
  ['bn','Bengali',['bn-IN','bn-BD','bn']]
];
var LANG_CANDIDATES=BASE_LANGS;

/* === Localized names === */
var L10N={
  en:{red:'red',blue:'blue',green:'green',yellow:'yellow',orange:'orange',pink:'pink',brown:'brown',black:'black',white:'white',violet:'violet',indigo:'indigo'},
  bn:{ red:'‡¶≤‡¶æ‡¶≤', blue:'‡¶®‡ßÄ‡¶≤', green:'‡¶∏‡¶¨‡ßÅ‡¶ú', yellow:'‡¶π‡¶≤‡ßÅ‡¶¶', orange:'‡¶ï‡¶Æ‡¶≤‡¶æ', pink:'‡¶ó‡ßã‡¶≤‡¶æ‡¶™‡¶ø', brown:'‡¶¨‡¶æ‡¶¶‡¶æ‡¶Æ‡ßÄ', black:'‡¶ï‡¶æ‡¶≤‡ßã', white:'‡¶∏‡¶æ‡¶¶‡¶æ', violet:'‡¶ú‡¶æ‡¶Æ‡ßÅ‡¶®‡¶ø', indigo:'‡¶®‡ßÄ‡¶≤‡¶ö‡ßá' }
};

/* === Audio/Speech === */
var voices=[], voice=null, currentLang='en', soundOn=true;

function speak(text){
  if(!soundOn || !voice || !text) return;
  try{
    var u=new SpeechSynthesisUtterance(text);
    u.voice=voice; u.rate=1; u.pitch=1;
    window.speechSynthesis.cancel(); window.speechSynthesis.speak(u);
  }catch(e){}
}

/* --- New: MP3 support for Bengali --- */
function speakColorKey(key, text){
  if(!text) text = (L10N[currentLang] && L10N[currentLang][key]) ? L10N[currentLang][key] : key;
  if(currentLang === 'bn' && soundOn){
    try{
      var audio = new Audio('animesh-him/audio/bn/' + key + '.mp3');
      var p = audio.play();
      if(p !== undefined){
        p.catch(function(){ speak(text); });
      }
      return;
    }catch(e){
      speak(text);
      return;
    }
  }
  speak(text);
}

function nameFor(key){ var pack=L10N[currentLang]||L10N.en; return pack[key]||key; }

/* === Game state === */
var playing=false, secs=60, score=0, target=0, timer=null, level=1;
var grid=document.getElementById('grid'), statusEl=document.getElementById('status');
function updateStatus(m){ statusEl.textContent='Status: '+m; }
function shuffle(a){ for(var i=a.length-1;i>0;i--){ var j=Math.floor(Math.random()*(i+1)); var t=a[i]; a[i]=a[j]; a[j]=t; } return a; }
function labelTone(hex){ var r=parseInt(hex.substr(1,2),16),g=parseInt(hex.substr(3,2),16),b=parseInt(hex.substr(5,2),16); var L=0.2126*(r/255)+0.7152*(g/255)+0.0722*(b/255); return (L<0.55)?'white':'black'; }

function nextRound(){ target=Math.floor(Math.random()*COLORS.length); speakColorKey(COLORS[target][0],nameFor(COLORS[target][0])); rebuildTiles(); }
function rebuildTiles(){
  grid.innerHTML='';
  var order=shuffle(COLORS.slice());
  order.forEach(function(item){
    var key=item[0], bg=item[1], d=document.createElement('button');
    d.className='cell'; d.style.background=bg; d.style.borderColor='#00000020'; d.style.width='100%';
    if(level===1){
      var tone=labelTone(bg), span=document.createElement('span');
      span.className='label3d '+(tone==='white'?'white':'black');
      span.textContent=key.toUpperCase();
      d.appendChild(span);
    }
    d.onclick=function(){ choose(key===COLORS[target][0]); };
    grid.appendChild(d);
  });
}
function choose(ok){
  if(!playing) return;
  if(ok){ score++; document.getElementById('s').textContent=score; updateStatus('Score: '+score); nextRound(); }
  else  { score=Math.max(0,score-1); document.getElementById('s').textContent=score; updateStatus('Score: '+score+' ‚Äî Try again!'); }
}

/* === Controls === */
document.getElementById('say').onclick=function(){ if(playing) speakColorKey(COLORS[target][0],nameFor(COLORS[target][0])); };
document.getElementById('start').onclick=function(){
  playing=true; secs=60; score=0;
  document.getElementById('s').textContent=0; document.getElementById('t').textContent=secs;
  var startLine="Let‚Äôs play ‚Äî gently tap on me!";
  updateStatus("Game started. Language: "+currentLang+" ‚Ä¢ Score: 0 ‚Äî "+startLine);
  speak(startLine);
  nextRound();
  if(timer) clearInterval(timer);
  timer=setInterval(function(){
    secs--; document.getElementById('t').textContent=secs;
    if(secs<=0){
      clearInterval(timer); playing=false;
      var endLine="Time‚Äôs up! Final score: "+score;
      updateStatus("‚è∞ "+endLine);
      speak(endLine);
    }
  },1000);
};
document.getElementById('mute').onclick=function(e){ soundOn=!soundOn; e.target.textContent=soundOn?'üîä Sound: On':'üîá Sound: Off'; };
document.getElementById('lvl1').onclick=function(){ level=1; this.classList.add('active'); document.getElementById('lvl2').classList.remove('active'); if(playing) rebuildTiles(); };
document.getElementById('lvl2').onclick=function(){ level=2; this.classList.add('active'); document.getElementById('lvl1').classList.remove('active'); if(playing) rebuildTiles(); };

/* === Language bar === */
var langbar=document.getElementById('langbar');
function refreshVoices(){
  try{ voices=window.speechSynthesis?window.speechSynthesis.getVoices():[]; }catch(e){ voices=[]; }
  langbar.innerHTML='';
  LANG_CANDIDATES.forEach(function(cfg){
    var code=cfg[0], label=cfg[1], tags=cfg[2];
    var v=voices.find(function(vc){ return tags.some(function(t){ return (vc.lang||'').toLowerCase().startsWith(t.toLowerCase()); }); });
    var b=document.createElement('button'); b.className='lbtn'; b.textContent=(code==='en')?'English':label; b.dataset.code=code;
    b.onclick=function(){
      currentLang=code; voice=v;
      Array.prototype.forEach.call(langbar.children,x=>x.classList.remove('active'));
      b.classList.add('active');
      updateStatus('Language: '+label+' ‚Ä¢ Score: '+score);
      if(playing) nextRound();
    };
    langbar.appendChild(b);
    if(code==='en' && !document.querySelector('.lbtn.active')){ b.classList.add('active'); currentLang='en'; voice=v; }
  });
}
try{
  if(window.speechSynthesis){
    window.speechSynthesis.onvoiceschanged=refreshVoices;
    setTimeout(refreshVoices,200);
  }else{
    updateStatus('Speech synthesis not available in this browser.');
  }
}catch(e){ updateStatus('Speech init error.'); }
</script>
</body>
</html>
