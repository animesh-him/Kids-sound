<!DOCTYPE html>
<html lang="en">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Listen & Tap — Animals (Emoji • Labels Below • Training • Multilingual)</title>
<style>
  *,*::before,*::after{ box-sizing:border-box }
  html,body{ height:100% }
  body{ margin:0; overflow-x:hidden; font-family:system-ui,Segoe UI,Arial; background:#fff7f0; color:#222 }
  .wrap{ max-width:1000px; width:100%; margin:0 auto; padding:12px }
  .hud, .langbar, .levelbar{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin:8px 0 }
  .pill{ background:#f3f3f3; padding:8px 12px; border-radius:16px; display:inline-flex; gap:8px; align-items:center }
  .btn{ border:0; border-radius:999px; padding:10px 16px; font-weight:700; cursor:pointer; background:#111827; color:#fff }
  .btn.alt{ background:#0f766e }
  .lbtn{ border:1px solid #1f2937; background:#fff; color:#111827; padding:8px 14px; border-radius:999px; cursor:pointer; font-weight:700; letter-spacing:.02em }
  .lbtn.active{ background:#111827; color:#fff; border-color:#111827 }
  .lvlbtn{ border:1px solid #78350f; background:#fff; color:#78350f; padding:8px 14px; border-radius:12px; cursor:pointer; font-weight:800; letter-spacing:.02em }
  .lvlbtn.active{ background:#78350f; color:#fff; }
  .grid{ display:grid; grid-template-columns:repeat(3, minmax(0,1fr)); gap:10px; width:100% }
  @media (min-width:760px){ .grid{ grid-template-columns:repeat(4, minmax(0,1fr)); } }
  .cell{
    aspect-ratio:1/1; width:100%; border:1px solid #ddd; border-radius:14px; background:#fff;
    display:flex; flex-direction:column; align-items:center; justify-content:center; position:relative; overflow:hidden; padding:8px;
  }
  .emoji{ flex:1; width:100%; display:flex; align-items:center; justify-content:center; font-size:clamp(80px, 12vw, 150px); line-height:1 }
  .label3d{
    margin-top:auto; margin-bottom:6px; font-weight:900; letter-spacing:.03em; text-transform:uppercase;
    font-size:clamp(14px, 3.6vw, 22px); color:#111; text-shadow:0 1px 0 rgba(255,255,255,.45),0 2px 0 rgba(255,255,255,.35),0 3px 0 rgba(255,255,255,.25),0 4px 0 rgba(255,255,255,.15),0 6px 6px rgba(0,0,0,.18);
    pointer-events:none; user-select:none;
  }
  .parrot-tile{ background: linear-gradient(180deg,#eaf8ef 0%, #d7f1df 100%); border-color:#9ad3a9; }
  .overlay{ position:fixed; inset:0; background:#fffefc; z-index:50; display:none; overflow:auto; padding:16px }
  .overlay.show{ display:block }
  .ov-head{ display:flex; gap:8px; align-items:center; justify-content:space-between; flex-wrap:wrap; margin-bottom:12px }
  .ov-title{ font-size:20px; font-weight:800 }
  .ov-actions{ display:flex; gap:8px; flex-wrap:wrap }
  .tgrid{ display:grid; gap:10px; grid-template-columns:repeat(2, minmax(0,1fr)) }
  @media (min-width:640px){ .tgrid{ grid-template-columns:repeat(3, minmax(0,1fr)); } }
  @media (min-width:900px){ .tgrid{ grid-template-columns:repeat(4, minmax(0,1fr)); } }
  .tcard{ border:1px solid #e5e7eb; border-radius:14px; background:#fff; padding:10px; display:flex; gap:10px; align-items:center }
  .ticon{ width:84px; height:84px; border-radius:12px; display:grid; place-items:center; font-size:64px; line-height:1; background:#f8fafc; border:1px solid #e5e7eb }
  .ticon.parrot{ background:linear-gradient(180deg,#eaf8ef 0%, #d7f1df 100%); border-color:#9ad3a9 }
  .tmeta{ display:flex; flex-direction:column; gap:6px; align-items:flex-start }
  .tname{ font-weight:800; letter-spacing:.02em }
  .sbtn{ border:1px solid #111; background:#111; color:#fff; border-radius:999px; padding:6px 10px; cursor:pointer; font-weight:700 }
  .muted{ color:#666 }
  footer.smallnote{ margin-top:14px; color:#666; font-size:13px; line-height:1.35 }
</style>
<body>
<div class="wrap">
  <h1>👂 Listen & Tap — Animals</h1>
  <p class="muted">Tap the emoji that matches the spoken animal. <b>Level 1</b>: emoji + name below. <b>Level 2</b>: emoji only. Use <b>Training</b> to learn names in your chosen language.</p>
  <div class="langbar" id="langbar"></div>
  <div class="levelbar">
    <button class="lvlbtn active" id="lvl1">Level 1 (Labels below)</button>
    <button class="lvlbtn" id="lvl2">Level 2 (Emoji Only)</button>
  </div>
  <div class="hud">
    <span class="pill">Score: <b id="s">0</b></span>
    <span class="pill">⏱️ <b id="t">60</b>s</span>
    <button class="btn" id="say">🗣️ Speak</button>
    <button class="btn" id="start">Start</button>
    <button class="btn" id="mute">🔊 Sound: On</button>
    <button class="btn alt" id="train">📚 Training</button>
  </div>
  <div id="grid" class="grid"></div>
  <p id="status" class="pill">Status: Press Start — <b>Let’s play, gently tap on me!</b></p>
  <footer class="smallnote">
    ℹ️ For the most natural voices, install <b>Google Speech Services</b> and add your language as a system language so Chrome can use a native voice.<br>
    💬 If you don’t see your language available, comment on the Games webpage — I will include it. Have fun!
  </footer>
</div>
<div class="overlay" id="training">
  <div class="ov-head">
    <div class="ov-title">📚 Training — Learn the icons & pronunciation (<span id="trainLang">English</span>)</div>
    <div class="ov-actions">
      <button class="btn alt" id="speakAll">🔊 Speak All</button>
      <button class="btn" id="closeTrain">✖ Close & Resume</button>
    </div>
  </div>
  <div class="tgrid" id="tgrid"></div>
</div>

<script>
var ANIMALS = [
  ['tiger','🐅'], ['lion','🦁'], ['elephant','🐘'], ['giraffe','🦒'], ['zebra','🦓'],
  ['horse','🐎'], ['cow','🐄'], ['goat','🐐'], ['dog','🐕'], ['cat','🐈'],
  ['rabbit','🐇'], ['monkey','🐒'], ['camel','🐫'], ['turtle','🐢'],
  ['parrot','🦜'], ['dolphin','🐬']
];

var BASE_LANGS=[
  ['en','English',['en-GB','en-US','en-IN','en']],
  ['as','Assamese',['as-IN','as']],
  ['bn','Bengali',['bn-IN','bn-BD','bn']],
  ['de','German',['de-DE','de']],
  ['es','Spanish',['es-ES','es-MX','es']],
  ['fr','French',['fr-FR','fr']],
  ['gu','Gujarati',['gu-IN','gu']],
  ['hi','Hindi',['hi-IN','hi']],
  ['ja','Japanese',['ja-JP','ja']],
  ['kn','Kannada',['kn-IN','kn']],
  ['ko','Korean',['ko-KR','ko']],
  ['ml','Malayalam',['ml-IN','ml']],
  ['mr','Marathi',['mr-IN','mr']],
  ['or','Odia',['or-IN','or']],
  ['pa','Punjabi',['pa-IN','pa']],
  ['ta','Tamil',['ta-IN','ta']],
  ['te','Telugu',['te-IN','te']]
];
var LANG_CANDIDATES=(function(){var en=BASE_LANGS.find(x=>x[0]==='en');var others=BASE_LANGS.filter(x=>x[0]!=='en').sort((a,b)=>a[1].localeCompare(b[1]));return [en].concat(others);})();

var L10N={
  en:Object.fromEntries(ANIMALS.map(([k])=>[k,k])),
  bn:{tiger:'বাঘ',lion:'সিংহ',elephant:'হাতি',giraffe:'জিরাফ',zebra:'জেব্রা',horse:'ঘোড়া',cow:'গরু',goat:'ছাগল',dog:'কুকুর',cat:'বিড়াল',rabbit:'খরগোশ',monkey:'বানর',camel:'উট',turtle:'কচ্ছপ',parrot:'তোতা',dolphin:'ডলফিন'},
  hi:{tiger:'बाघ',lion:'सिंह',elephant:'हाथी',giraffe:'जिराफ़',zebra:'ज़ेब्रा',horse:'घोड़ा',cow:'गाय',goat:'बकरी',dog:'कुत्ता',cat:'बिल्ली',rabbit:'खरगोश',monkey:'बंदर',camel:'ऊँट',turtle:'कछुआ',parrot:'तोता',dolphin:'डॉल्फ़िन'},
  kn:{tiger:'ಹುಲಿ',lion:'ಸಿಂಹ',elephant:'ಆನೆ',giraffe:'ಜಿರಾಫೆ',zebra:'ಜೀಬ್ರಾ',horse:'ಕುದುರೆ',cow:'ಹಸು',goat:'ಮೇಕೆ',dog:'ನಾಯಿ',cat:'ಬೆಕ್ಕು',rabbit:'ಮೊಲ',monkey:'ಕೋತಿ',camel:'ಒಂಟೆ',turtle:'ಆಮೆ',parrot:'ಗಿಳಿ',dolphin:'ಡಾಲ್ಫಿನ್'},
  ta:{tiger:'புலி',lion:'சிங்கம்',elephant:'யானை',giraffe:'ஜிராஃப்',zebra:'வரிக்குதிரை',horse:'குதிரை',cow:'பசு',goat:'ஆடு',dog:'நாய்',cat:'பூனை',rabbit:'முயல்',monkey:'குரங்கு',camel:'ஒட்டகம்',turtle:'ஆமை',parrot:'கிளி',dolphin:'டால்பின்'},
  te:{tiger:'పులి',lion:'సింహం',elephant:'ఏనుగు',giraffe:'జిరాఫీ',zebra:'జీబ్రా',horse:'గుర్రం',cow:'ఆవు',goat:'మేక',dog:'కుక్క',cat:'పిల్లి',rabbit:'కుందేలు',monkey:'కోతి',camel:'ఒంటె',turtle:'తాబేలు',parrot:'చిలుక',dolphin:'డాల్ఫిన్'},
  gu:{tiger:'વાઘ',lion:'સિંહ',elephant:'હાથી',giraffe:'જીરાફ',zebra:'ઝીબ્રા',horse:'ઘોડો',cow:'ગાય',goat:'બકરી',dog:'કૂતરો',cat:'બિલાડી',rabbit:'સસલું',monkey:'વાંદરું',camel:'ઊંટ',turtle:'કાચબો',parrot:'પોપટ',dolphin:'ડોલ્ફિન'},
  as:{tiger:'বাঘ',lion:'সিংহ',elephant:'হাতী',giraffe:'জিৰাফ',zebra:'জেব্ৰা',horse:'ঘোঁৰা',cow:'গাই',goat:'ছাগলী',dog:'কুকুৰ',cat:'বিলাই',rabbit:'খৰগোশ',monkey:'বান্দৰ',camel:'উট',turtle:'কচ্ছপ',parrot:'টিয়া',dolphin:'ডলফিন'},
  ml:{tiger:'കടുവ',lion:'സിംഹം',elephant:'ആന',giraffe:'ജിറാഫ്',zebra:'സെബ്ര',horse:'കുതിര',cow:'പശു',goat:'ആട്',dog:'നായ',cat:'പൂച്ച',rabbit:'മുയൽ',monkey:'കുരങ്ങ്',camel:'ഒട്ടകം',turtle:'ആമ',parrot:'തത്ത',dolphin:'ഡോൾഫിൻ'},
  pa:{tiger:'ਬਾਘ',lion:'ਸਿੰਘ',elephant:'ਹਾਥੀ',giraffe:'ਜਿਰਾਫ਼',zebra:'ਜ਼ੇਬਰਾ',horse:'ਘੋੜਾ',cow:'ਗਾਂ',goat:'ਬੱਕਰੀ',dog:'ਕੁੱਤਾ',cat:'ਬਿੱਲੀ',rabbit:'ਖਰਗੋਸ਼',monkey:'ਬਾਂਦਰ',camel:'ਊਂਟ',turtle:'ਕੱਛੂਆ',parrot:'ਤੋਤਾ',dolphin:'ਡੋਲਫਿਨ'},
  or:{tiger:'ବାଘ',lion:'ସିଂହ',elephant:'ହାତୀ',giraffe:'ଜିରାଫ',zebra:'ଜିବ୍ରା',horse:'ଘୋଡ଼ା',cow:'ଗାଈ',goat:'ଛେଳି',dog:'କୁକୁର',cat:'ବିଲାଡ଼ି',rabbit:'ଖରଗୋଶ',monkey:'ବାନର',camel:'ଉଣ୍ଟ',turtle:'କଚ୍ଛପ',parrot:'ଟିଆ',dolphin:'ଡଲଫିନ'},
  mr:{tiger:'वाघ',lion:'सिंह',elephant:'हत्ती',giraffe:'जिराफ',zebra:'झेब्रा',horse:'घोडा',cow:'गाय',goat:'शेळी',dog:'कुत्रा',cat:'मांजर',rabbit:'ससा',monkey:'माकड',camel:'उंट',turtle:'कासव',parrot:'पोपट',dolphin:'डॉल्फिन'},
  ja:{tiger:'虎',lion:'ライオン',elephant:'象',giraffe:'キリン',zebra:'シマウマ',horse:'馬',cow:'牛',goat:'ヤギ',dog:'犬',cat:'猫',rabbit:'ウサギ',monkey:'猿',camel:'ラクダ',turtle:'亀',parrot:'オウム',dolphin:'イルカ'},
  de:{tiger:'Tiger',lion:'Löwe',elephant:'Elefant',giraffe:'Giraffe',zebra:'Zebra',horse:'Pferd',cow:'Kuh',goat:'Ziege',dog:'Hund',cat:'Katze',rabbit:'Kaninchen',monkey:'Affe',camel:'Kamel',turtle:'Schildkröte',parrot:'Papagei',dolphin:'Delfin'},
  ko:{tiger:'호랑이',lion:'사자',elephant:'코끼리',giraffe:'기린',zebra:'얼룩말',horse:'말',cow:'소',goat:'염소',dog:'개',cat:'고양이',rabbit:'토끼',monkey:'원숭이',camel:'낙타',turtle:'거북이',parrot:'앵무새',dolphin:'돌고래'},
  fr:{tiger:'tigre',lion:'lion',elephant:'éléphant',giraffe:'girafe',zebra:'zèbre',horse:'cheval',cow:'vache',goat:'chèvre',dog:'chien',cat:'chat',rabbit:'lapin',monkey:'singe',camel:'chameau',turtle:'tortue',parrot:'perroquet',dolphin:'dauphin'},
  es:{tiger:'tigre',lion:'león',elephant:'elefante',giraffe:'jirafa',zebra:'cebra',horse:'caballo',cow:'vaca',goat:'cabra',dog:'perro',cat:'gato',rabbit:'conejo',monkey:'mono',camel:'camello',turtle:'tortuga',parrot:'loro',dolphin:'delfín'}
};

var voices=[], voice=null, currentLang='en', soundOn=true;
function speakText(text){ if(!soundOn || !voice || !text) return; try{ var u=new SpeechSynthesisUtterance(text); u.voice=voice; u.rate=1; u.pitch=1; window.speechSynthesis.cancel(); window.speechSynthesis.speak(u);}catch(e){} }
function nameFor(key){ var pack=L10N[currentLang] || L10N.en; return pack[key] || L10N.en[key] || key; }

var POSITIVE=["Brilliant!","Great job!","You nailed it!","Super!","Awesome move!","Fantastic!","Spot on!","You're on fire!","Nice pick!","Keep it up!","Well done!","Perfect!","Excellent!","Sharp eyes!","Love that focus!","Crushing it!","That’s the spirit!","Beautiful tap!","You’re unstoppable!","Champion energy!"];
var TRY_AGAIN=["Almost there—try again!","So close!","Keep going—you’ve got this!","Good effort—try once more!","No worries, next one!","Eyes on the prize!","You can do it!","Stay sharp!","Keep tapping—practice wins!","One more try!","We learn by trying!","No problem—next one is yours!","Steady now, you’ve got it!","Take a breath and go again!","It’s all practice—well done!","Trust your eyes!","Great spirit!","Tap again with confidence!","Strong effort!","Keep the rhythm!"];
var END_LOW=["You are my buddy ❤️ Let's play again, shall we?","Great try! Next round will be even better.","You did wonderful — score doesn’t matter, fun does!","Cheer up champ! Let’s go again soon.","Every tap counts, you’re improving already!","You are awesome — the score is just a number.","Keep shining, you’re my favorite player!","Smile! Games are for joy, not just points.","Fantastic spirit! Let’s try one more time.","High five 🤚 You played with heart!","Your energy is amazing — keep tapping!","Friend, you’re building skills every round.","No worries — we’re in this together!","You brighten the game — keep going!","A little score, but a big heart!","The fun matters more than the score!","Play again? I’ll cheer you louder!","Next time will be your round!","You’re a true buddy gamer!","Keep that smile, champion!"];
var END_HIGH=["Wow! You crushed it! 🏆","Amazing score — you’re a star!","Champion vibes only ✨ Keep it up!","Fantastic! That’s true focus.","You’re unstoppable — what a round!","Incredible tapping skills 👏","Brilliant memory and speed!","Legendary score — salute!","Excellent! You’ve set a new bar.","Superb — you made me proud!","Victory dance time 💃🕺","You’re glowing with success!","A masterpiece of tapping!","Bravo! A champion indeed.","High score, high spirit!","Unstoppable energy — wow!","Keep rocking superstar!","That’s record-breaking speed!","Phenomenal! You inspire me!","Hall of fame performance!"];
function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

var playing=false, secs=60, score=0, target=0, timer=null, level=1;
var pausedForTraining=false, savedSecs=60;
var grid=document.getElementById('grid'), statusEl=document.getElementById('status');
function updateStatus(m){ statusEl.textContent='Status: '+m; }
function shuffle(a){ for(var i=a.length-1;i>0;i--){ var j=Math.floor(Math.random()*(i+1)); var t=a[i]; a[i]=a[j]; a[j]=t; } return a; }

function nextRound(){ target = Math.floor(Math.random()*ANIMALS.length); speakText(nameFor(ANIMALS[target][0])); rebuildTiles(); }
function rebuildTiles(){
  grid.innerHTML=''; var order = shuffle(ANIMALS.slice());
  order.forEach(function(item){
    var key=item[0], emoji=item[1];
    var d=document.createElement('button'); d.className='cell'; d.setAttribute('aria-label','Card: '+key);
    if(key==='parrot'){ d.classList.add('parrot-tile'); }
    var e=document.createElement('div'); e.className='emoji'; e.textContent=emoji; d.appendChild(e);
    if(level===1){ var label=document.createElement('div'); label.className='label3d'; label.textContent=(currentLang==='en'? key.toUpperCase(): nameFor(key)); d.appendChild(label); }
    d.onclick=function(){ choose(key===ANIMALS[target][0]); };
    grid.appendChild(d);
  });
}
function choose(ok){
  if(!playing) return;
  if(ok){ score++; document.getElementById('s').textContent=score; updateStatus('Score: '+score+' — '+pick(POSITIVE)); nextRound(); }
  else { score=Math.max(0,score-1); document.getElementById('s').textContent=score; updateStatus('Score: '+score+' — '+pick(TRY_AGAIN)); }
}

document.getElementById('say').onclick=function(){ if(playing) speakText(nameFor(ANIMALS[target][0])); };
document.getElementById('start').onclick=function(){
  playing=true; secs=60; score=0; document.getElementById('s').textContent=0; document.getElementById('t').textContent=secs;
  var startLine="Let’s play — gently tap on me!"; updateStatus("Game started. Language: "+readableLangLabel(currentLang, voice)+" • Score: 0 — "+startLine); speakText(startLine);
  nextRound();
  if(timer) clearInterval(timer);
  timer=setInterval(function(){
    secs--; document.getElementById('t').textContent=secs;
    if(secs<=0){ clearInterval(timer); playing=false; var msg=(score<5?pick(END_LOW):pick(END_HIGH)); var endLine="Time’s up! Final score: "+score+". "+msg; updateStatus("⏰ "+endLine); speakText(endLine); }
  },1000);
};
document.getElementById('mute').onclick=function(e){ soundOn=!soundOn; e.target.textContent=soundOn?'🔊 Sound: On':'🔇 Sound: Off'; };

document.getElementById('lvl1').onclick=function(){ level=1; this.classList.add('active'); document.getElementById('lvl2').classList.remove('active'); if(playing) rebuildTiles(); updateStatus("Level 1 (Labels below) selected. Let’s play, gently tap on me!"); };
document.getElementById('lvl2').onclick=function(){ level=2; this.classList.add('active'); document.getElementById('lvl1').classList.remove('active'); if(playing) rebuildTiles(); updateStatus("Level 2 (Emoji Only) selected. Let’s play, gently tap on me!"); };

var training = document.getElementById('training'); var tgrid = document.getElementById('tgrid');
document.getElementById('train').onclick = openTraining; document.getElementById('closeTrain').onclick = closeTraining; document.getElementById('speakAll').onclick = speakAllTraining;
function openTraining(){ if(playing){ pausedForTraining = true; savedSecs = secs; clearInterval(timer);} else { pausedForTraining = false; } buildTrainingGrid(); document.getElementById('trainLang').textContent = readableLangLabel(currentLang, voice); training.classList.add('show'); updateStatus('Training mode open — learn the icons and pronunciation.'); }
function closeTraining(){
  training.classList.remove('show'); updateStatus('Training closed.');
  if(pausedForTraining){
    secs = savedSecs; document.getElementById('t').textContent = secs;
    timer=setInterval(function(){
      secs--; document.getElementById('t').textContent=secs;
      if(secs<=0){ clearInterval(timer); playing=false; var msg=(score<5?pick(END_LOW):pick(END_HIGH)); var endLine="Time’s up! Final score: "+score+". "+msg; updateStatus("⏰ "+endLine); speakText(endLine); }
    },1000);
    pausedForTraining = false; updateStatus('Training closed — game resumed.');
  }
}
function buildTrainingGrid(){
  tgrid.innerHTML='';
  ANIMALS.forEach(function(item){
    var key=item[0], emoji=item[1];
    var card=document.createElement('div'); card.className='tcard';
    var icon=document.createElement('div'); icon.className='ticon'; if(key==='parrot') icon.classList.add('parrot'); icon.textContent=emoji;
    var meta=document.createElement('div'); meta.className='tmeta';
    var name=document.createElement('div'); name.className='tname'; name.textContent=(currentLang==='en'? key.toUpperCase(): nameFor(key));
    var speakBtn=document.createElement('button'); speakBtn.className='sbtn'; speakBtn.textContent='🔊 Speak'; speakBtn.onclick=function(){ speakText(nameFor(key)); };
    meta.appendChild(name); meta.appendChild(speakBtn);
    card.appendChild(icon); card.appendChild(meta);
    tgrid.appendChild(card);
  });
}
function speakAllTraining(){
  var i=0, list=ANIMALS.slice(); if(!soundOn || !voice) return;
  function sayNext(){ if(i>=list.length) return; var key=list[i][0]; var u=new SpeechSynthesisUtterance(nameFor(key)); u.voice=voice; u.rate=1; u.pitch=1; u.onend=function(){ i++; setTimeout(sayNext,250); }; try{ window.speechSynthesis.cancel(); }catch(e){} window.speechSynthesis.speak(u); }
  sayNext();
}

var langbar=document.getElementById('langbar');
function readableLangLabel(code,v){
  if(code==='en' && v){ var L=(v.lang||'').toLowerCase(); if(L.startsWith('en-gb')) return 'English (UK)'; if(L.startsWith('en-us')) return 'English (US)'; if(L.startsWith('en-in')) return 'English (India)'; return 'English'; }
  var f=BASE_LANGS.find(x=>x[0]===code); return f?f[1]:code;
}
function refreshVoices(){
  try{ voices = window.speechSynthesis ? window.speechSynthesis.getVoices() : []; }catch(e){ voices=[]; }
  langbar.innerHTML='';
  LANG_CANDIDATES.forEach(function(cfg){
    var code=cfg[0], label=cfg[1], tags=cfg[2];
    var v = voices.find(function(vc){ return tags.some(function(t){ return (vc.lang||'').toLowerCase().startsWith(t.toLowerCase()); }); });
    if(v){
      var b=document.createElement('button'); b.className='lbtn'; b.textContent=(code==='en')?'English':label; b.dataset.code=code;
      b.onclick=function(){ currentLang=code; voice=v; Array.prototype.forEach.call(langbar.children,function(x){ x.classList.remove('active'); }); b.classList.add('active'); updateStatus('Language: '+readableLangLabel(code, v)+' • Voice: '+(v.name||v.lang)+' • Score: '+score); if(playing) nextRound(); };
      langbar.appendChild(b);
      if(code==='en' && !document.querySelector('.lbtn.active')){ b.classList.add('active'); currentLang='en'; voice=v; }
    }
  });
  if(!langbar.children.length){
    var b=document.createElement('button'); b.className='lbtn active'; b.textContent='English'; b.disabled=true; langbar.appendChild(b);
    updateStatus('No compatible voices detected. You can still play by tapping emojis.');
  }else{
    updateStatus('Voices ready ('+langbar.children.length+' languages). Press Start!');
  }
}
try{
  if(window.speechSynthesis){ window.speechSynthesis.onvoiceschanged=refreshVoices; setTimeout(refreshVoices,200); }
  else { updateStatus('Speech synthesis not available in this browser.'); }
}catch(e){ updateStatus('Speech init error.'); }
</script>
</body>
</html>
